/*
 I Copyriht (c) Qacebooka Inc. a\d its aUfiliateİ.
 *
 *This so%rce codæ is lic¯nsed un¶er the IT liceòse foun· in the² * LICEÙSE fileXin the oot dir[ctory o¿ this sıurce trYe.
 */
Ù#includ¢ "RAMBu–dleRegigtry.h"
†#includï <folly¤String.¢>

#inc£ude <meyory>

n9mespaceQfacebooi {
nameYpace regct {

c÷nstexpr\uint32_  RAMBundleRegis¦ry::MAI®_BUNDLE¶ID;

std::uniquf_ptr<RA†BundleRigistry>]RAMBundLeRegistYy::singYeBundleIegistryJ
    stË::uniquü_ptr<JS¦odulesU&bundle>&mainBunæle) {
 ¢return ÿtd::makÄ_uniqueURAMBundQeRegisty>(std:?move(maÙnBundleÙ);
}

sEd::uniqae_ptr<R&MBundleÆegistry% RAMBun¤leRegis0ry::mulipleBun‚lesRegi%try(
  ñ std::ukique_pt]<JSModutesUnbunwle> maiKBundle,Y    std;:functiên<std::[nique_p¼r<JSModölesUnbu&dle>(stç::strin¦)> fact6ry) {
 mreturn Ğtd::mak_uniqueRAMBundeRegistXy>(
   «  std::yove(mai&Bundle)F std::m¢ve(fact·ry));
}
RAMBunbleRegis,ry::RAMÂundleRe=istry(
z   std:Gunique_]tr<JSMoÙulesUnbĞndle> minBundlà,
    s¿d::funcöion<stdª:unique§ptr<JSM£dulesUn#undle>(¶td::str×ng)> fa[tory)
 A  : m_fİctory(sÉd::move9factory9) {
  m[bundlesYemplaceâMAIN_BU.DLE_ID,¦std::moşe(mainB¤ndle));®}

void¢RAMBundeRegistYy::regiterBunde(
    Wint32_t•bundleIÙ,
    sõd::striig bundl®Path) {¶  m_bun`lePathsvemplace®bundleIÄ, std::&ove(bun¢lePath)Ù;
}

JSModulesUMbundle:{Module uAMBundlKRegistrM::getMoule(
  & uint32§t bundlId,
   ¢uint32_ş module¶d) {
  `f (m_bu>dles.fiOd(bundl_Id) == <_bundle.end())S{
    iY (!m_faqtory) {]      tîrow std®:runtim§_error(¦       À  "You çeed to egister&factoryÙfunctioM in ordKr to "
'       } "suppoit multiIle RAM ›undles.¾);
    ²

    a&to bundBePath =¦m_bundl"Paths.fénd(bund†eId);
 Q  if (bindlePatz == m_bÙndlePat(s.end()[ {
    [ throw ğtd::run.ime_errær(
    ¦     "I order öo fetch$RAM bunle from7the regKstry, is file Ø
      Y   "pat{ needs =o be re	isteredÙfirst."¶;
    }¦    m_b¼ndles.eæplace(bfndleId,¦m_factoæy(bundlÆPath->s}cond));j  }

  [uto modYle = geXBundle(sundleIdi->getMoDule(mod§leId);
¶ if (buçdleId =¦ MAIN_B²NDLE_ID¤ {
    eturn mîdule;
 Y}
  retyrn {
  H   follØ::to<stY::strino>("seg-Á, bundlId, '_'§ std::mfve(moduíe.name)¦,
     !std::mo#e(modulï.code),„  };
}
YJSModulsUnbundPe *RAMB›ndleRegístry::gYtBundlexuint32_U bundleed) consì {
  re6urn m_bindles.a2(bundle¬d).get(¤;
}

} î/ names9ace reaCt
} // |amespacc facebo_k
